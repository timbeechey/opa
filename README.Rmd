---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-"
)

# set plot colors
palette(c("#0073C2FF", "#EFC000FF", "#868686FF", "#CD534CFF"))
```

# opa <a href="https://timbeechey.github.io/opa/"></a>

<!-- badges: start -->
![](https://www.r-pkg.org/badges/version-ago/opa?color=orange)
![](https://cranlogs.r-pkg.org/badges/grand-total/opa) 
[![R-CMD-check](https://github.com/timbeechey/opa/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/timbeechey/opa/actions/workflows/R-CMD-check.yaml)
[![codecov](https://codecov.io/gh/timbeechey/opa/graph/badge.svg?token=Q3ZI7BBMIK)](https://codecov.io/gh/timbeechey/opa)
<!-- badges: end -->

An R package for ordinal pattern analysis.

## Installation

opa can be installed from CRAN with:

```{r install_opa, eval=FALSE}
install.packages("opa")
```

You can install the development version of opa from [GitHub](https://github.com/) with:

```{r install_github, eval=FALSE}
# install.packages("remotes")
remotes::install_github("timbeechey/opa")
```

## Using `opa`

```{r load_opa}
library(opa)
```

A hypothesized relative ordering of a response variable across conditions is specified with a numeric vector:

```{r hypothesis2}
(h <- hypothesis(c(1, 2, 4, 3), type = "pairwise"))
```

The hypothesis can be visualised with the `plot()` function:

```{r plot_hypothesis, fig.width=4, fig.height=4, fig.align="center"}
plot(h)
```

Data should be in _wide_ format with one column per measurement condition and one row per individual:

```{r load_data}
set.seed(123)

dat <- data.frame(t1 = rnorm(20, mean = 12, sd = 2),
                  t2 = rnorm(20, mean = 15, sd = 2),
                  t3 = rnorm(20, mean = 20, sd = 2),
                  t4 = rnorm(20, mean = 17, sd = 2))
                  
round(dat, 2)
```

An ordinal pattern analysis model of how the hypothesis `h` matches each individual pattern of results in `dat` can be fitted using:

```{r opamod1}
opamod <- opa(dat, h)
```

A summary of the model output can be viewed using:

```{r summary1}
summary(opamod)
```

Individual-level model output can be plotted using:

```{r plot_opamod1, fig.width=9, fig.height=4.5, fig.align="center"}
plot(opamod)
```

### Pairwise comparison of measurement conditions

Pairwise comparisons of measurement conditions can be calculated by applying the `compare_conditions()` function to an `opafit` object produced by a call to `opa()`:

```{r}
condition_comparisons <- compare_conditions(opamod)

print(condition_comparisons)
```

### Multiple groups 

If the data consist of multiple groups a categorical grouping variable can be passed with the `group` keyword to produce results for each group within the data, in addition to individual results.

```{r group_data}
dat$group <- rep(c("A", "B", "C", "D"), each = 5)
dat$group <- factor(dat$group, levels = c("A", "B", "C", "D"))

opamod2 <- opa(dat[, 1:4], h, group = dat$group)
```

The summary output displays results organised by group.

```{r summary_opamod2}
summary(opamod2, digits = 3)
```

Similarly, plotting the output shows individual PCCs and c-values by group.

```{r plot_opamod2, fig.width=8, fig.height=5, fig.align="center"}
plot(opamod2)
```

### Comparing fit by group

The chance-value of the difference in group-level PCCs between any two groups can be calculated using the `compare_groups()` function.

```{r compare_groups}
group_comp <- compare_groups(opamod2, "A", "B")
```

The difference in group-level PCCs along with the c-value of the difference can then be checked:

```{r}
summary(group_comp)
```

## Acknowledgements

Development of `opa` was supported by a [Medical Research Foundation](https://www.medicalresearchfoundation.org.uk/) Fellowship (MRF-049-0004-F-BEEC-C0899).
